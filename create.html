<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Create your card</title>
<style>:root{color-scheme:light dark}body{margin:0;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Arial;background:#eef3f1}main{max-width:840px;margin:24px auto;padding:0 16px}form{background:#fff;border-radius:16px;padding:24px;box-shadow:0 12px 40px rgba(0,0,0,.08);display:grid;gap:14px}label{font-size:14px;opacity:.8}input,textarea{width:100%;padding:10px 12px;border:1px solid #dcdcdc;border-radius:10px;font:inherit}.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}.actions{display:flex;gap:12px;align-items:center}button{background:#111;color:#fff;border:0;border-radius:12px;padding:12px 16px;cursor:pointer}.note{opacity:.7;font-size:13px}.out{margin-top:16px}.success{background:#fff;border-radius:12px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.08)}.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}</style>
</head><body><main>
<h1>Create your card</h1>
<form id="cardForm">
<div class="row"><div><label>Full name</label><input name="name" required placeholder="Ivica Jakimovski"></div><div><label>Job title</label><input name="title" placeholder="Generalen Direktor"></div></div>
<div class="row"><div><label>Company</label><input name="company" placeholder="Golden Art"></div><div><label>Phone (intl)</label><input name="phone" required placeholder="+389 70 369 666"></div></div>
<div class="row"><div><label>Email</label><input name="email" type="email" required placeholder="ivica@goldenart.mk"></div><div><label>Website</label><input name="website" placeholder="https://goldenart.mk"></div></div>
<div><label>Work address</label><input name="address" placeholder="Street, City, Region, Postal, Country"></div>
<div><label>Logo (image)</label><input id="logo" type="file" accept="image/*"><div class="note">We’ll optimize the image; optional.</div></div>
<div class="actions"><button type="submit">Generate</button><span class="note">You’ll get a link like <span class="mono">/card/your-name-1234</span></span></div>
</form>
<div id="out" class="out"></div>
</main>
<script>
async function toJpegDataUrl(file,max=800,quality=0.9){return new Promise((resolve,reject)=>{const img=new Image();const fr=new FileReader();fr.onload=()=>{img.src=fr.result};fr.onerror=reject;img.onload=()=>{const ratio=Math.min(1,max/Math.max(img.width,img.height));const w=Math.round(img.width*ratio),h=Math.round(img.height*ratio);const c=document.createElement('canvas');c.width=w;c.height=h;const ctx=c.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,w,h);ctx.drawImage(img,0,0,w,h);resolve(c.toDataURL('image/jpeg',quality))};img.onerror=reject;fr.readAsDataURL(file)})}
document.getElementById('cardForm').addEventListener('submit',async(e)=>{e.preventDefault();const fd=new FormData(e.target);const payload={name:fd.get('name')?.trim(),title:fd.get('title')?.trim(),company:fd.get('company')?.trim(),phone:fd.get('phone')?.trim(),email:fd.get('email')?.trim(),website:fd.get('website')?.trim(),address:fd.get('address')?.trim()};const file=document.getElementById('logo').files[0];if(file)payload.logoDataUrl=await toJpegDataUrl(file);const res=await fetch('/.netlify/functions/create_profile',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const json=await res.json();const out=document.getElementById('out');if(!res.ok){out.innerHTML='<div class="success">Error: '+(json.message||'Unknown')+'</div>';return}out.innerHTML='<div class="success">Your card is ready:<br><a href="'+json.card_url+'" target="_blank">'+location.origin+json.card_url+'</a><br>Save-contact link: <span class="mono">'+json.vcf_url+'</span></div>'});</script>
</body></html>