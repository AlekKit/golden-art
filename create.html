<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Create your card</title>
<style>
  /* ===== Theme tokens ===== */
  :root{
    --bg1:#e8f0ec; --bg2:#f6faf8;
    --panel:#ffffff; --panel-border:rgba(15,23,32,.08);
    --text:#0f1720; --muted:#66737e;
    --input-bg:#f7fafb; --input-br:#d8e0e6;
    --ring:#1f2937;
    --btn:#111111; --btnText:#ffffff; --btnBorder:transparent;
    --secondaryBorder:#dde5ea;
    --shadow:0 30px 80px rgba(0,0,0,.14);
    --shadow-sm:0 10px 30px rgba(0,0,0,.08);
    --accent:#0ea5e9;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg1:#0b1014; --bg2:#0f171c;
      --panel:#12181d; --panel-border:rgba(255,255,255,.06);
      --text:#eef3f1; --muted:#a7b2bb;
      --input-bg:#0f151a; --input-br:#26323b;
      --ring:#7dd3fc;
      --btn:#e9e9e9; --btnText:#0b0b0b; --btnBorder:#e9e9e9;
      --secondaryBorder:#2b3943;
      --shadow:0 30px 80px rgba(0,0,0,.5);
      --shadow-sm:0 10px 30px rgba(0,0,0,.35);
      --accent:#38bdf8;
    }
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100dvh;
    font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Arial;
    color:var(--text);
    background:
      radial-gradient(1000px 500px at 10% -10%, var(--bg2), transparent 60%),
      radial-gradient(900px 500px at 110% 0%, var(--bg2), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
  }

  .wrap{max-width:980px;margin:36px auto;padding:0 20px}
  header{display:flex;align-items:center;justify-content:space-between;margin:8px 0 18px}
  .logoWrap{display:flex;align-items:center;gap:12px}
  .logoDot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px var(--accent)}
  h1{margin:0;font-size:32px;letter-spacing:.2px}
  .backLink{
    font-size:14px; font-weight:500; text-decoration:none;
    background:var(--panel); border:1px solid var(--secondaryBorder);
    padding:8px 14px; border-radius:10px;
    color:var(--text);
    box-shadow:var(--shadow-sm);
    transition:background .15s ease, transform .06s ease;
  }
  .backLink:hover{background:var(--input-bg); transform:translateY(-1px)}

  .card{
    background:var(--panel);
    border:1px solid var(--panel-border);
    border-radius:22px;
    box-shadow:var(--shadow);
    padding:26px 24px;
    backdrop-filter:saturate(120%) blur(2px);
  }

  /* form grid */
  form{display:grid;gap:18px}
  .grid-2{display:grid;gap:18px;grid-template-columns:1fr 1fr}
  @media (max-width:820px){.grid-2{grid-template-columns:1fr}}

  label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}

  .field{position:relative}
  .field input[type=text],
  .field input[type=email],
  .field input[type=url],
  .field input[type=tel]{
    width:100%;
    padding:14px 16px 14px 46px; /* room for icon */
    border:1px solid var(--input-br);
    background:var(--input-bg);
    border-radius:14px;
    color:var(--text);
    outline:none;
    transition:border-color .15s ease, box-shadow .15s ease, transform .04s ease;
  }
  .field input:focus{
    border-color:var(--ring);
    box-shadow:0 0 0 3px color-mix(in srgb, var(--ring) 22%, transparent);
  }
  .field svg{
    position:absolute;left:14px;top:50%;transform:translateY(-50%);
    width:18px;height:18px;opacity:.55
  }

  /* file input */
  .fileRow{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
  .fileRow input[type=file]{display:none}
  .btn-file{
    display:inline-flex;align-items:center;gap:8px;
    background:var(--btn); color:var(--btnText);
    border:1px solid var(--btnBorder);
    border-radius:12px;padding:10px 14px;cursor:pointer;
    box-shadow:var(--shadow-sm); transition:transform .06s ease, opacity .15s ease;
  }
  .btn-file:hover{transform:translateY(-1px);opacity:.95}
  .hint{font-size:12px;color:var(--muted)}
  .preview{width:64px;height:64px;border-radius:50%;overflow:hidden;background:#111;display:grid;place-items:center;box-shadow:var(--shadow-sm)}
  .preview img{width:100%;height:100%;object-fit:cover}

  /* actions */
  .actions{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:4px}
  .btn{
    background:var(--btn); color:var(--btnText);
    border:1px solid var(--btnBorder);
    border-radius:14px; padding:12px 18px; font-weight:600; cursor:pointer;
    box-shadow:var(--shadow-sm); transition:transform .06s ease, opacity .15s ease;
  }
  .btn:hover{transform:translateY(-1px);opacity:.96}
  .note{font-size:13px;color:var(--muted)}

  /* Result box */
  #result{
    margin-top:12px; font-size:14px; word-break:break-word;
    background:var(--input-bg); border:1px dashed var(--input-br);
    border-radius:14px; padding:12px 14px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logoWrap">
        <span class="logoDot"></span>
        <h1>Create your card</h1>
      </div>
      <a class="backLink" href="/">← Back to homepage</a>
    </header>

    <div class="card">
      <form id="createForm" onsubmit="return false;">
        <div class="grid-2">
          <div>
            <label for="name">Full name</label>
            <div class="field">
              <input id="name" type="text" placeholder="Enter full name"/>
            </div>
          </div>
          <div>
            <label for="title">Job title</label>
            <div class="field">
              <input id="title" type="text" placeholder="Enter job title"/>
            </div>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label for="company">Company</label>
            <div class="field">
              <input id="company" type="text" placeholder="Enter company"/>
            </div>
          </div>
          <div>
            <label for="phone">Mobile phone</label>
            <div class="field">
              <input id="phone" type="tel" placeholder="+389 70 123 456"/>
            </div>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label for="email">Email</label>
            <div class="field">
              <input id="email" type="email" placeholder="name@company.com"/>
            </div>
          </div>
          <div>
            <label for="website">Website</label>
            <div class="field">
              <input id="website" type="url" placeholder="https://company.com"/>
            </div>
          </div>
        </div>

        <div>
          <label for="address">Address</label>
          <div class="field">
            <input id="address" type="text" placeholder="Street, City, Country"/>
          </div>
        </div>

        <div>
          <label>Logo / photo</label>
          <div class="fileRow">
            <label class="btn-file">
              <input id="logo" type="file" accept="image/*"/>
              Choose file
            </label>
            <div class="preview"><img id="preview" alt=""></div>
            <div class="hint">JPEG/PNG; large images are compressed automatically.</div>
          </div>
        </div>

        <div class="actions">
          <button id="generateBtn" class="btn">Generate</button>
          <span class="note">After generating, you’ll get the card URL below.</span>
        </div>

        <div id="result"></div>
      </form>
    </div>
  </div>

  <script>
    let imageBase64 = null;
    let imageMime = null;

    const fileInput = document.getElementById('logo');
    const previewImg = document.getElementById('preview');
    fileInput?.addEventListener('change', () => {
      const f = fileInput.files?.[0];
      if (!f) { previewImg.removeAttribute('src'); imageBase64 = null; return; }
      const r = new FileReader();
      r.onload = e => {
        previewImg.src = e.target.result;
        const base64String = e.target.result.split(',')[1]; // only data
        imageBase64 = base64String;
        imageMime = f.type;
      };
      r.readAsDataURL(f);
    });

    document.getElementById('generateBtn').addEventListener('click', async () => {
      const payload = {
        name: document.getElementById('name').value,
        title: document.getElementById('title').value,
        company: document.getElementById('company').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        website: document.getElementById('website').value,
        address: document.getElementById('address').value,
        image_base64: imageBase64,
        image_mime: imageMime
      };

      const res = await fetch('/.netlify/functions/create_profile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      const resultBox = document.getElementById('result');
      if (data.slug) {
        resultBox.innerHTML = `
          Your card is ready!<br>
          <a href="/card/${data.slug}" target="_blank">https://max-mcard.netlify.app/card/${data.slug}</a>
        `;
      } else {
        resultBox.textContent = "Error: " + JSON.stringify(data);
      }
    });
  </script>
</body>
</html>
